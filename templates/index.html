<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Recommender</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f6f8fa;
            color: #24292e;
            padding: 2rem;
            display: flex;
            justify-content: center;
        }
        .container {
            width: 100%;
            max-width: 1200px;
            margin: auto;
            background: #ffffff;
            padding: 2rem;
            border-radius: 6px;
            border: 1px solid #d0d7de;
        }
        h1 {
            text-align: center;
            color: #0969da;
            margin-bottom: 2rem;
        }
        form {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        input[type="text"] {
            flex-grow: 1;
            padding: 0.75rem;
            font-size: 1rem;
            border: 1px solid #d0d7de;
            border-radius: 6px;
        }
        button {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            background-color: #0969da;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #0550ae;
        }
        #results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1.5rem;
        }
        .book-card {
            border: 1px solid #d0d7de;
            border-radius: 6px;
            background: #ffffff;
            overflow: hidden;
            text-align: center;
        }
        .book-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }
        .img-placeholder {
            width: 100%;
            height: 250px;
            background-color: #f6f8fa;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #57606a;
            font-size: 0.9rem;
        }
        .card-content {
            padding: 1rem;
        }
        .card-content h3 {
            font-size: 1rem;
            font-weight: 600;
            margin: 0.5rem 0;
            color: #24292e;
        }
        .card-content p {
            font-size: 0.9rem;
            color: #57606a;
            margin: 0;
        }
        #loader {
            display: none;
            text-align: center;
            font-size: 1.2rem;
            margin: 2rem;
        }
        #error-container {
            display: none;
            color: #d73a49;
            background-color: #ffebe9;
            border: 1px solid #d73a49;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    
    <div class="container">
        <h1>ðŸ“š Book Recommender</h1>
        
        <form id="recommend-form">
            <input type="text" id="book-search" list="book-titles" placeholder="Type a book title..." autocomplete="off">
            <datalist id="book-titles">
                {% for title in book_titles %}
                    <option value="{{ title }}">
                {% endfor %}
            </datalist>
            
            <button type="submit">Recommend</button>
        </form>
        
        <div id="loader">Loading...</div>
        <div id="error-container"></div>
        <div id="results"></div>
    </div>

    <script>
        // Function to check if a URL is valid
        function isValidHttpUrl(string) {
            try {
                const url = new URL(string);
                return url.protocol === 'http:' || url.protocol === 'https:';
            } catch (_) {
                return false;  
            }
        }

        // All JavaScript is here. No jQuery. No Select2.
        document.getElementById('recommend-form').addEventListener('submit', async function(e) {
            e.preventDefault(); 

            let bookName = document.getElementById('book-search').value;
            if (!bookName) return;

            let resultsDiv = document.getElementById('results');
            let loader = document.getElementById('loader');
            let errorContainer = document.getElementById('error-container');

            // --- Reset UI ---
            resultsDiv.innerHTML = ''; 
            loader.style.display = 'block';
            errorContainer.style.display = 'none';

            try {
                let formData = new FormData();
                formData.append('book_name', bookName);

                let response = await fetch('/recommend', {
                    method: 'POST',
                    body: formData
                });

                let recommendations = await response.json();
                loader.style.display = 'none'; // Hide loader

                if (recommendations.error) {
                    errorContainer.innerText = `An error occurred: ${recommendations.error}`;
                    errorContainer.style.display = 'block';
                } else if (recommendations.length === 0) {
                    errorContainer.innerText = 'No recommendations found for this book.';
                    errorContainer.style.display = 'block';
                } else {
                    recommendations.forEach(book => {
                        // --- Image Fallback Logic ---
                        let imageUrl = book['Image-URL-M'];
                        let imageHtml = '';
                        
                        if (isValidHttpUrl(imageUrl)) {
                            imageHtml = `<img src="${imageUrl}" alt="Cover of ${book['Book-Title']}">`;
                        } else {
                            imageHtml = `<div class="img-placeholder">No Image Available</div>`;
                        }

                        // --- This is the simple card HTML ---
                        let card = `
                            <div class="book-card">
                                ${imageHtml}
                                <div class="card-content">
                                    <h3>${book['Book-Title']}</h3>
                                    <p>${book['Book-Author']}</p>
                                </div>
                            </div>
                        `;
                        resultsDiv.innerHTML += card;
                    });
                }
            } catch (error) {
                loader.style.display = 'none';
                errorContainer.innerText = 'A network error occurred. Please try again.';
                errorContainer.style.display = 'block';
                console.error('Error:', error);
            }
        });
    </script>
    
</body>
</html>
